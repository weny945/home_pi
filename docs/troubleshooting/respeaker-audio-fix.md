# ReSpeaker éŸ³é¢‘é…ç½®å¿«é€ŸæŒ‡å—

**é—®é¢˜**: TTS æ’­æ”¾å¤±è´¥æˆ–æ‚éŸ³

**åŸå› **:
1. é…ç½®æ–‡ä»¶ä¸­çš„ `output_device` ä¸æ­£ç¡®ï¼ˆä½¿ç”¨äº† `plughw:0,0` è€Œä¸æ˜¯ `plughw:2,0`ï¼‰
2. WAV æ–‡ä»¶æ ¼å¼å¯èƒ½ä¸å…¼å®¹

---

## ğŸš€ å¿«é€Ÿä¿®å¤ï¼ˆæ¨èï¼‰

### æ­¥éª¤ 1: è‡ªåŠ¨é…ç½®

åœ¨æ ‘è“æ´¾ä¸Šè¿è¡Œï¼š

```bash
cd ~/home_pi
python3 tests/manual/quick_setup_audio.py
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- âœ… è‡ªåŠ¨æŸ¥æ‰¾ ReSpeaker è®¾å¤‡ç¼–å·
- âœ… è‡ªåŠ¨æ›´æ–° `config.yaml`
- âœ… æµ‹è¯•éŸ³é¢‘æ’­æ”¾

### æ­¥éª¤ 2: éªŒè¯é…ç½®

æ£€æŸ¥ `config.yaml` ä¸­çš„é…ç½®ï¼š

```yaml
audio:
  input_device: "seeed-4mic-voicecard"
  output_device: "plughw:2,0"  # â† å…³é”®ï¼åº”è¯¥æ˜¯ card 2
  sample_rate: 16000
  channels: 1
  chunk_size: 512
```

### æ­¥éª¤ 3: æµ‹è¯•æ’­æ”¾

```bash
cd ~/home_pi
source .venv/bin/activate
python3 tests/manual/test_software.py
```

é€‰æ‹© `[2]` æµ‹è¯• TTS åé¦ˆæ’­æ”¾å™¨ï¼Œåº”è¯¥èƒ½å¬åˆ°æ¸…æ™°çš„è¯­éŸ³äº†ã€‚

---

## ğŸ”§ æ‰‹åŠ¨é…ç½®

å¦‚æœè‡ªåŠ¨é…ç½®ä¸å·¥ä½œï¼Œæ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š

```bash
cd ~/home_pi
vim config.yaml
```

æ‰¾åˆ° `audio:` éƒ¨åˆ†ï¼Œä¿®æ”¹ä¸ºï¼š

```yaml
audio:
  input_device: "seeed-4mic-voicecard"
  output_device: "plughw:2,0"  # ReSpeaker æ˜¯ card 2
  sample_rate: 16000
  channels: 1
  chunk_size: 512
  format: "int16"
```

ä¿å­˜åæµ‹è¯•ï¼š

```bash
python3 tests/manual/test_software.py
# é€‰æ‹© [2]
```

---

## ğŸ§ª æµ‹è¯•éŸ³é¢‘è®¾å¤‡

### 1. æŸ¥æ‰¾ ReSpeaker è®¾å¤‡ç¼–å·

```bash
aplay -l | grep -i respeaker
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
card 2: ArrayUAC10 [ReSpeaker 4 Mic Array (UAC1.0)]
```

è¿™æ„å‘³ç€ ReSpeaker æ˜¯ **card 2**ã€‚

### 2. æµ‹è¯• ReSpeaker éŸ³é¢‘è¾“å‡º

```bash
# æµ‹è¯• card 2 çš„è®¾å¤‡ 0
speaker-test -t wav -c 1 -D plughw:2,0
```

**é¢„æœŸç»“æœ**: èƒ½å¬åˆ°æµ‹è¯•éŸ³ï¼ˆç™½å™ªéŸ³æˆ–æ­£å¼¦æ³¢ï¼‰

### 3. å¦‚æœ plughw:2,0 ä¸å·¥ä½œ

å°è¯•å…¶ä»–è®¾å¤‡ï¼š

```bash
# å°è¯• hw:2,0
speaker-test -t wav -c 1 -D hw:2,0

# å°è¯• default
speaker-test -t wav -c 1 -D default
```

---

## ğŸ“‹ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæ˜¯ card 2 è€Œä¸æ˜¯ card 0ï¼Ÿ

A: æ ‘è“æ´¾ç³»ç»Ÿå¯èƒ½æœ‰å¤šä¸ªéŸ³é¢‘è®¾å¤‡ï¼š
- card 0 = æ ‘è“æ´¾å†…ç½®éŸ³é¢‘ï¼ˆ3.5mm æˆ– HDMIï¼‰
- card 1 = å…¶ä»– USB éŸ³é¢‘
- card 2 = ReSpeaker 4 Mic Array

### Q2: ä»€ä¹ˆæ˜¯ plughw vs hw?

A:
- `plughw:2,0` = æ’ä»¶å±‚ï¼Œ**è‡ªåŠ¨è½¬æ¢é‡‡æ ·ç‡**ï¼ˆæ¨èï¼‰
- `hw:2,0` = ç›´æ¥ç¡¬ä»¶è®¿é—®ï¼Œè¦æ±‚é‡‡æ ·ç‡ç²¾ç¡®åŒ¹é…

Piper TTS è¾“å‡º 22050 Hzï¼Œå¿…é¡»ç”¨ `plughw` è¿›è¡Œè½¬æ¢ã€‚

### Q3: ä¸ºä»€ä¹ˆä¼šæœ‰æ‚éŸ³ï¼Ÿ

A: å¯èƒ½åŸå› ï¼š
1. âŒ ä½¿ç”¨äº†é”™è¯¯çš„è®¾å¤‡ï¼ˆå¦‚ `plughw:0,0`ï¼‰
2. âŒ WAV æ–‡ä»¶æ ¼å¼ä¸å…¼å®¹
3. âŒ é‡‡æ ·ç‡ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**:
- âœ… ä½¿ç”¨ `plughw:2,0`
- âœ… å·²æ›´æ–° WAV æ–‡ä»¶å†™å…¥ä»£ç 
- âœ… `plughw` ä¼šè‡ªåŠ¨å¤„ç†é‡‡æ ·ç‡è½¬æ¢

### Q4: å¦‚ä½•ç¡®è®¤é…ç½®æ­£ç¡®ï¼Ÿ

A: è¿è¡Œæµ‹è¯•ï¼š

```bash
python3 tests/manual/test_software.py
# é€‰æ‹© [2] æµ‹è¯• TTS åé¦ˆæ’­æ”¾å™¨
```

åº”è¯¥èƒ½å¬åˆ°æ¸…æ™°çš„ä¸­æ–‡è¯­éŸ³ï¼ˆ"æˆ‘åœ¨"ã€"è¯·å©å’"ç­‰ï¼‰ï¼Œè€Œä¸æ˜¯æ‚éŸ³ã€‚

---

## ğŸ“ é…ç½®æ–‡ä»¶ç¤ºä¾‹

å®Œæ•´çš„ `config.yaml` éŸ³é¢‘éƒ¨åˆ†ï¼š

```yaml
# ========================================
# éŸ³é¢‘é…ç½®
# ========================================
audio:
  # è¾“å…¥è®¾å¤‡ï¼ˆReSpeaker éº¦å…‹é£é˜µåˆ—ï¼‰
  input_device: "seeed-4mic-voicecard"

  # è¾“å‡ºè®¾å¤‡ï¼ˆReSpeaker 3.5mm æ¥å£ï¼‰
  # card 2 = ReSpeaker 4 Mic Array
  output_device: "plughw:2,0"

  # å…¶ä»–é…ç½®
  sample_rate: 16000
  channels: 1
  chunk_size: 512
  format: "int16"
```

---

## ğŸ” è¯Šæ–­å·¥å…·

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¿è¡Œå®Œæ•´çš„è¯Šæ–­ï¼š

```bash
# éŸ³é¢‘è®¾å¤‡è¯Šæ–­
python3 tests/manual/diagnose_audio.py

# å¿«é€Ÿé…ç½®
python3 tests/manual/quick_setup_audio.py

# æ‰‹åŠ¨æ£€æŸ¥
aplay -l
cat /proc/asound/cards
```

---

## âœ… æˆåŠŸæ ‡å¿—

é…ç½®æ­£ç¡®åï¼Œè¿è¡Œæµ‹è¯•åº”è¯¥çœ‹åˆ°ï¼š

```
============================================================
æµ‹è¯• 2: TTS åé¦ˆæ’­æ”¾å™¨
============================================================

ğŸ“¦ åˆå§‹åŒ– TTS åé¦ˆæ’­æ”¾å™¨...
âœ… æ’­æ”¾å™¨åˆå§‹åŒ–æˆåŠŸ
   è¾“å‡ºè®¾å¤‡: plughw:2,0

------------------------------------------------------------
éŸ³é¢‘æ’­æ”¾æµ‹è¯•
------------------------------------------------------------

  [1/3] æ’­æ”¾: 'æˆ‘åœ¨'
  âœ… æ’­æ”¾å®Œæˆ (è€—æ—¶: 0.80 ç§’)

  [2/3] æ’­æ”¾: 'è¯·å©å’'
  âœ… æ’­æ”¾å®Œæˆ (è€—æ—¶: 1.10 ç§’)

  [3/3] æ’­æ”¾: 'æˆ‘åœ¨å¬'
  âœ… æ’­æ”¾å®Œæˆ (è€—æ—¶: 0.79 ç§’)

âœ… TTS åé¦ˆæ’­æ”¾å™¨æµ‹è¯•é€šè¿‡!
```

**å…³é”®ç‚¹**:
- âœ… æ²¡æœ‰é”™è¯¯ä¿¡æ¯
- âœ… èƒ½å¬åˆ°æ¸…æ™°çš„ä¸­æ–‡è¯­éŸ³
- âœ… æ’­æ”¾æ—¶é—´åˆç†ï¼ˆ0.7-1.1ç§’ï¼‰

---

## ğŸ’¡ æç¤º

1. **è®¾å¤‡ç¼–å·å¯èƒ½ä¼šå˜åŒ–**ï¼Œæ¯æ¬¡é‡å¯åç¡®è®¤ï¼š
   ```bash
   aplay -l | grep -i respeaker
   ```

2. **ä½¿ç”¨è‡ªåŠ¨é…ç½®è„šæœ¬**æœ€å®‰å…¨ï¼š
   ```bash
   python3 tests/manual/quick_setup_audio.py
   ```

3. **æµ‹è¯•ç®€å•éŸ³é¢‘**éªŒè¯è®¾å¤‡ï¼š
   ```bash
   speaker-test -t wav -c 1 -D plughw:2,0
   ```

---

éœ€è¦å¸®åŠ©ï¼Ÿè¿è¡Œ `python3 tests/manual/diagnose_audio.py` è·å–å®Œæ•´çš„è¯Šæ–­æŠ¥å‘Šã€‚
