# 音乐播放功能说明

## 功能概述

音乐播放功能允许通过语音控制播放本地音乐文件，支持播放、暂停、停止、音量调节等操作。

## 支持的音乐格式

- MP3 (`.mp3`)
- WAV (`.wav`)
- OGG Vorbis (`.ogg`)
- FLAC (`.flac`)
- M4A (`.m4a`)
- AAC (`.aac`)

## 目录结构

音乐文件应放置在 `assets/music/` 目录下：

```
assets/music/
├── song1.mp3                    # 直接放在根目录
├── song2.wav
├── Artist1/                     # 按艺术家分类
│   ├── Album1/
│   │   ├── track1.flac
│   │   └── track2.flac
│   └── Album2/
│       └── track3.mp3
└── Artist2/
    └── track4.ogg
```

## 语音命令

### 播放音乐

- "派蒙，播放音乐"
- "派蒙，来点小曲"
- "派蒙，烘托氛围"
- "派蒙，听歌"
- "派蒙，背景音乐"

### 播放指定歌曲

- "派蒙，播放《歌曲名》"
- "派蒙，来首《歌曲名》"

### 控制播放

- "派蒙，暂停" / "派蒙，停一下"
- "派蒙，继续" / "派蒙，恢复播放"
- "派蒙，停止" / "派蒙，关掉音乐"

### 音量调节

- "派蒙，大声点" / "派蒙，放大音量"
- "派蒙，小声点" / "派蒙，减小音量"

## 配置说明

在 `config.yaml` 中配置：

```yaml
music:
  enabled: true                      # 是否启用
  library:
    path: "./assets/music"           # 音乐目录
    recursive: true                  # 递归扫描子目录
  player:
    initial_volume: 0.7              # 初始音量 (0.0-1.0)
```

## 使用示例

### 示例1：随机播放

```
用户: "派蒙，播放音乐"
助手: "好的，随机播放一首音乐"
系统: ▶️  开始播放: 歌曲名
```

### 示例2：指定歌曲

```
用户: "派蒙，播放《夜曲》"
助手: "好的，为您播放《夜曲》"
系统: ▶️  开始播放: 周杰伦 - 夜曲
```

### 示例3：音量调节

```
用户: "派蒙，大声点"
助手: "好的，音量已调大到 80%"
系统: 🔊 音量设置为: 80%
```

## 技术实现

- **播放引擎**: pygame.mixer
- **扫描方式**: 递归扫描子目录
- **播放模式**: 后台播放，不阻塞其他功能
- **元数据解析**: 从目录结构提取艺术家、专辑信息

## 测试方法

```bash
# 单元测试
pytest tests/unit/test_music_library.py -v

# E2E 测试
pytest tests/manual/test_music_e2e.py -v -s
```

## 常见问题

### Q: 音乐文件放在哪里？

A: 放在 `assets/music/` 目录下，支持多级子目录。

### Q: 支持哪些音乐格式？

A: MP3, WAV, OGG, FLAC, M4A, AAC 等常见格式。

### Q: 如何添加音乐？

A: 将音乐文件复制到 `assets/music/` 目录即可，支持子目录分类。

### Q: 能否在线播放音乐？

A: 当前版本仅支持本地音乐，在线音乐功能已预留接口。

## 后续增强

- 在线音乐播放
- 播放列表管理
- 进度控制（快进、快退）
- 歌词显示
- 音乐推荐
