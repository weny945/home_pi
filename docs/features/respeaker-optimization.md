# ReSpeaker å”¤é†’è¯è¯†åˆ«ç‡ä¼˜åŒ–æ–¹æ¡ˆ

æ ¹æ® Seeed Studio å®˜æ–¹æ–‡æ¡£ï¼Œä»¥ä¸‹æ˜¯æé«˜ ReSpeaker è¯†åˆ«ç‡çš„æ–¹æ³•ï¼š

## ä¸€ã€é˜ˆå€¼è°ƒæ•´ï¼ˆå…³é”®è®¾ç½®ï¼‰

### 1.1 è°ƒæ•´å”¤é†’è¯é˜ˆå€¼

ReSpeaker ä½¿ç”¨ **é˜ˆå€¼ï¼ˆthresholdï¼‰** æ¥æ§åˆ¶çµæ•åº¦ï¼š
- **é˜ˆå€¼è¶Šå°** â†’ è¶Šçµæ• â†’ å®¹æ˜“å”¤é†’ï¼Œä½†è¯¯å”¤é†’å¤š
- **é˜ˆå€¼è¶Šå¤§** â†’ è¶Šä¸çµæ• â†’ è¯¯å”¤é†’å°‘ï¼Œä½†å¯èƒ½æ¼æ£€

**é˜ˆå€¼æ ¼å¼**ï¼šä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚ `1e-30` è¡¨ç¤º `10^-30`

**é˜ˆå€¼èŒƒå›´**ï¼š
- `1e-20` â†’ éå¸¸çµæ•ï¼ˆå®¹æ˜“è¯¯å”¤é†’ï¼‰
- `1e-30` â†’ é»˜è®¤å€¼ï¼ˆå¹³è¡¡ï¼‰
- `1e-50` â†’ éå¸¸ä¿å®ˆï¼ˆå¾ˆéš¾è¯¯å”¤é†’ï¼‰
- `1e-100` â†’ æåº¦ä¿å®ˆï¼ˆå‡ ä¹ä¸å”¤é†’ï¼‰

### 1.2 OpenWakeWord é˜ˆå€¼è®¾ç½®

åœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œå”¤é†’è¯é˜ˆå€¼åœ¨ `config.yaml` ä¸­é…ç½®ï¼š

```yaml
wakeword:
  engine: "openwakeword"
  model: "paimon_paimon_zh.ppn"
  threshold: 0.5                         # é»˜è®¤é˜ˆå€¼ (0-1)
```

**ä¼˜åŒ–å»ºè®®**ï¼š

```yaml
# å¦‚æœè¯¯å”¤é†’å¤ªå¤šï¼ˆç»å¸¸å¬åˆ°æ‚éŸ³å°±å”¤é†’ï¼‰
wakeword:
  threshold: 0.7                         # æé«˜é˜ˆå€¼ï¼ˆé™ä½çµæ•åº¦ï¼‰

# å¦‚æœç»å¸¸å”¤é†’ä¸åˆ°ï¼ˆéœ€è¦å¤§å£°è¯´æ‰èƒ½å”¤é†’ï¼‰
wakeword:
  threshold: 0.3                         # é™ä½é˜ˆå€¼ï¼ˆæé«˜çµæ•åº¦ï¼‰
```

**è°ƒä¼˜æ­¥éª¤**ï¼š
1. ä»é»˜è®¤å€¼ 0.5 å¼€å§‹
2. å¦‚æœè¯¯å”¤é†’å¤š â†’ å¢åŠ åˆ° 0.6, 0.7, 0.8
3. å¦‚æœå”¤é†’ä¸åˆ° â†’ å‡å°‘åˆ° 0.4, 0.3, 0.2
4. æ‰¾åˆ°æœ€é€‚åˆä½ ç¯å¢ƒçš„å¹³è¡¡ç‚¹

## äºŒã€å£°éŸ³é€‚åº”è®­ç»ƒ

### 2.1 è®­ç»ƒä½ çš„ä¸“å±å”¤é†’è¯æ¨¡å‹

OpenWakeWord æ”¯æŒè‡ªå®šä¹‰è®­ç»ƒï¼Œå¯ä»¥æ˜¾è‘—æé«˜è¯†åˆ«ç‡ï¼š

**ä¼˜åŠ¿**ï¼š
- é€‚åº”ä½ çš„å£°éŸ³ç‰¹å¾
- é€‚åº”ä½ çš„å£éŸ³
- é€‚åº”ç¯å¢ƒå™ªéŸ³

**è®­ç»ƒæ–¹æ³•**ï¼š
å‚è€ƒ OpenWakeWord å®˜æ–¹æ–‡æ¡£è¿›è¡Œè®­ç»ƒï¼š
https://github.com/dscripka/openWakeWord

### 2.2 ä½¿ç”¨æ›´å¥½çš„æ¨¡å‹

å½“å‰é¡¹ç›®ä½¿ç”¨çš„æ˜¯ `paimon_paimon_zh.ppn`ï¼ˆæ´¾è’™å”¤é†’è¯ï¼‰ã€‚

**æ›¿ä»£æ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨å®˜æ–¹æä¾›çš„æ›´å‡†ç¡®æ¨¡å‹
2. è®­ç»ƒè‡ªå·±çš„æ¨¡å‹
3. ä½¿ç”¨å¤šä¸ªæ¨¡å‹å¹¶æŠ•ç¥¨å†³ç­–

## ä¸‰ã€ç¯å¢ƒä¼˜åŒ–

### 3.1 å‡å°‘ç¯å¢ƒå™ªéŸ³

**å™ªéŸ³æ¥æº**ï¼š
- ç”µè„‘é£æ‰‡ã€ç©ºè°ƒã€ç”µè§†
- è¡—é“å™ªéŸ³
- å…¶ä»–ç”µå­è®¾å¤‡

**ä¼˜åŒ–æ–¹æ³•**ï¼š
- è¿œç¦»å™ªéŸ³æº
- ä½¿ç”¨æŒ‡å‘æ€§éº¦å…‹é£
- è°ƒæ•´éº¦å…‹é£ä½ç½®

### 3.2 éº¦å…‹é£ä½ç½®ä¼˜åŒ–

**æ¨èä½ç½®**ï¼š
- è·ç¦»è¯´è¯è€… 1-3 ç±³
- æ­£å¯¹è¯´è¯è€…
- é¿å…éšœç¢ç‰©é®æŒ¡

**ReSpeaker 4-Mic Array ä¼˜åŠ¿**ï¼š
- æ³¢æŸæˆå½¢æŠ€æœ¯
- 360Â° å…¨å‘æ‹¾éŸ³
- è‡ªåŠ¨é™å™ª

## å››ã€ç¡¬ä»¶å¢å¼º

### 4.1 ä½¿ç”¨ ReSpeaker 4-Mic Array

ä½ å·²ç»åœ¨ä½¿ç”¨ï¼è¿™æ˜¯æœ€ä½³é€‰æ‹©ä¹‹ä¸€ï¼š
- 4 ä¸ªéº¦å…‹é£é˜µåˆ—
- XMOS å¤šæ¨¡æ€ Sensing æŠ€æœ¯
- æ³¢æŸæˆå½¢å’Œå™ªå£°æŠ‘åˆ¶

### 4.2 éŸ³é¢‘è´¨é‡ä¼˜åŒ–

åœ¨ `config.yaml` ä¸­ä¼˜åŒ–éŸ³é¢‘é…ç½®ï¼š

```yaml
audio:
  sample_rate: 16000                     # ä¿æŒ 16kHz
  channels: 1                            # å•å£°é“ï¼ˆæ³¢æŸæˆå½¢åï¼‰
  chunk_size: 512                        # éŸ³é¢‘å—å¤§å°
```

## äº”ã€è½¯ä»¶ç®—æ³•ä¼˜åŒ–

### 5.1 è‡ªé€‚åº” VAD

ä½ çš„é¡¹ç›®å·²ç»å®ç°äº†è‡ªé€‚åº” VADï¼ˆPhase 1.4ï¼‰ï¼š

```yaml
audio_quality:
  vad:
    adaptive_enabled: true               # å¯ç”¨è‡ªé€‚åº”é˜ˆå€¼
    base_threshold: 0.04                 # åŸºç¡€é˜ˆå€¼
    adaptation_factor: 1.5               # è‡ªé€‚åº”ç³»æ•°
```

**è¿™ä¼šè‡ªåŠ¨è°ƒæ•´åº•å™ªæ°´å¹³ï¼Œæé«˜è¯†åˆ«ç‡ï¼**

### 5.2 å›å£°æ£€æµ‹

é¡¹ç›®å·²å®ç°å›å£°æ£€æµ‹ï¼ˆé˜²æ­¢é‡å¤å”¤é†’ï¼‰ï¼š

```python
echo_detection_words = [
    "æ´¾è’™", "alexa", "å°çˆ±", "siri", "å¤©çŒ«ç²¾çµ",
    "æˆ‘åœ¨", "è¯·å©å’", "æˆ‘åœ¨å¬", "æ‚¨å¥½", "æˆ‘åœ¨è¿™é‡Œ"
]
```

## å…­ã€æ¨èçš„é…ç½®ç»„åˆ

### 6.1 é«˜çµæ•åº¦é…ç½®ï¼ˆé€‚åˆå®‰é™ç¯å¢ƒï¼‰

```yaml
wakeword:
  threshold: 0.3                         # é«˜çµæ•åº¦

audio_quality:
  vad:
    base_threshold: 0.02                 # é™ä½é˜ˆå€¼
    adaptation_factor: 1.2               # å¿«é€Ÿé€‚åº”
```

### 6.2 ä½è¯¯å”¤é†’é…ç½®ï¼ˆé€‚åˆå˜ˆæ‚ç¯å¢ƒï¼‰

```yaml
wakeword:
  threshold: 0.7                         # ä½çµæ•åº¦

audio_quality:
  vad:
    base_threshold: 0.06                 # æé«˜é˜ˆå€¼
    adaptation_factor: 2.0               # å¼ºé€‚åº”
```

### 6.3 å¹³è¡¡é…ç½®ï¼ˆæ¨èï¼‰

```yaml
wakeword:
  threshold: 0.5                         # é»˜è®¤å€¼

audio_quality:
  vad:
    adaptive_enabled: true               # å¯ç”¨è‡ªé€‚åº”
    base_threshold: 0.04                 # é»˜è®¤å€¼
    adaptation_factor: 1.5               # é»˜è®¤å€¼
```

## ä¸ƒã€æµ‹è¯•ä¸è°ƒä¼˜

### 7.1 æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œå”¤é†’è¯æµ‹è¯•
python tests/manual/test_wake_word_real.py

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/phase1.log
```

### 7.2 ç›‘æ§æŒ‡æ ‡

åœ¨æ—¥å¿—ä¸­å…³æ³¨ï¼š
- `ğŸ¤ æ£€æµ‹åˆ°å”¤é†’è¯ï¼` â†’ æˆåŠŸå”¤é†’
- è¯¯å”¤é†’æ¬¡æ•°ï¼ˆæ— å®é™…è¯´è¯ä½†æ£€æµ‹åˆ°å”¤é†’è¯ï¼‰
- æ¼æ£€æ¬¡æ•°ï¼ˆè¯´äº†å”¤é†’è¯ä½†æ²¡æ£€æµ‹åˆ°ï¼‰

### 7.3 è°ƒä¼˜æµç¨‹

1. **åŸºå‡†æµ‹è¯•**ï¼šä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆthreshold: 0.5ï¼‰
2. **é—®é¢˜è¯†åˆ«**ï¼šè®°å½•è¯¯å”¤é†’å’Œæ¼æ£€æƒ…å†µ
3. **é˜ˆå€¼è°ƒæ•´**ï¼š
   - è¯¯å”¤é†’å¤š â†’ å¢åŠ  threshold
   - æ¼æ£€å¤š â†’ å‡å°‘ threshold
4. **éªŒè¯æ•ˆæœ**ï¼šé‡æ–°æµ‹è¯•
5. **è¿­ä»£ä¼˜åŒ–**ï¼šæ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹

## å…«ã€é«˜çº§ä¼˜åŒ–

### 8.1 è®­ç»ƒè‡ªå®šä¹‰æ¨¡å‹

å¦‚æœ OpenWakeWord çš„é»˜è®¤æ¨¡å‹æ•ˆæœä¸å¥½ï¼Œå¯ä»¥è®­ç»ƒè‡ªå·±çš„æ¨¡å‹ï¼š

```bash
# å‚è€ƒ OpenWakeWord å®˜æ–¹æ–‡æ¡£
# https://github.com/dscripka/openWakeWord

# éœ€è¦å‡†å¤‡ï¼š
# 1. ä½ çš„å£°éŸ³æ ·æœ¬ï¼ˆå¤šæ¬¡è¯´å‡ºå”¤é†’è¯ï¼‰
# 2. ç¯å¢ƒå™ªéŸ³æ ·æœ¬
# 3. è®­ç»ƒè„šæœ¬
```

### 8.2 å¤šæ¨¡å‹æŠ•ç¥¨

ä½¿ç”¨å¤šä¸ªå”¤é†’è¯æ¨¡å‹ï¼ŒæŠ•ç¥¨å†³å®šæ˜¯å¦å”¤é†’ï¼š

```python
# ä¼ªä»£ç ç¤ºä¾‹
if model1.detect() and model2.detect():
    # ä¸¤ä¸ªæ¨¡å‹éƒ½æ£€æµ‹åˆ°ï¼Œæ‰å”¤é†’
    trigger_wakeup()
```

## ä¹ã€å®˜æ–¹æ–‡æ¡£å‚è€ƒ

æ ¹æ® ReSpeaker å®˜æ–¹ FAQ Q17ï¼š

> **We can reduce the false positive rate by increase the threshold in the keyword.txt, but it also reduce the sensibility.**
>
> **Another way is to adapt your voice with current acoustic module.**

è¿™æ˜¯å®˜æ–¹ç»™å‡ºçš„ä¸¤ä¸ªæ–¹æ³•ï¼š
1. **å¢åŠ é˜ˆå€¼** - é™ä½è¯¯å”¤é†’ç‡
2. **å£°éŸ³é€‚åº”** - æé«˜ä¸ªä½“è¯†åˆ«ç‡

## åã€å®ç”¨å»ºè®®

### 10.1 å¿«é€Ÿä¼˜åŒ–ï¼ˆ3æ­¥ï¼‰

1. **è°ƒæ•´é˜ˆå€¼**ï¼šä¿®æ”¹ `config.yaml` ä¸­çš„ `wakeword.threshold`
   - è¯¯å”¤é†’å¤š â†’ æ”¹ä¸º 0.6 æˆ– 0.7
   - å”¤é†’ä¸åˆ° â†’ æ”¹ä¸º 0.3 æˆ– 0.4

2. **å¯ç”¨è‡ªé€‚åº” VAD**ï¼šç¡®ä¿ `audio_quality.vad.adaptive_enabled: true`

3. **æµ‹è¯•éªŒè¯**ï¼šè¿è¡Œ `pytest tests/manual/test_wake_word_real.py -v -s`

### 10.2 ç»ˆæä¼˜åŒ–

å¦‚æœä¸Šè¿°æ–¹æ³•ä»ç„¶ä¸ç†æƒ³ï¼š
1. è®­ç»ƒä¸“å±å”¤é†’è¯æ¨¡å‹ï¼ˆä½¿ç”¨ OpenWakeWordï¼‰
2. ä½¿ç”¨æ›´å¥½çš„éº¦å…‹é£ç¡¬ä»¶
3. ä¼˜åŒ–ä½¿ç”¨ç¯å¢ƒï¼ˆå‡å°‘å™ªéŸ³ï¼‰
4. è€ƒè™‘ä½¿ç”¨å…¶ä»–å”¤é†’è¯å¼•æ“ï¼ˆå¦‚ Porcupineï¼‰

## åä¸€ã€é…ç½®ç¤ºä¾‹

### é«˜è´¨é‡é…ç½®ç¤ºä¾‹

```yaml
# config.yaml

# å”¤é†’è¯é…ç½®
wakeword:
  engine: "openwakeword"
  model: "paimon_paimon_zh.ppn"
  threshold: 0.5                         # æ ¹æ®ç¯å¢ƒè°ƒæ•´ (0.2-0.8)
  model_dir: "./models/openwakeword"

# éŸ³é¢‘è´¨é‡æ£€æµ‹
audio_quality:
  enabled: true

  # è‡ªé€‚åº” VADï¼ˆå…³é”®ï¼ï¼‰
  vad:
    adaptive_enabled: true               # å¿…é¡»å¯ç”¨
    base_threshold: 0.04                 # åŸºç¡€é˜ˆå€¼
    adaptation_factor: 1.5               # è‡ªé€‚åº”ç³»æ•°
    noise_window_size: 100               # åº•å™ªæ ·æœ¬çª—å£

  # æ™ºèƒ½å°¾ç«¯ç‚¹æ£€æµ‹
  smart_silence_threshold: 2.0           # æ™ºèƒ½é™éŸ³è¶…æ—¶

# éŸ³é¢‘è¾“å…¥
audio:
  input_device: "seeed-4mic-voicecard"    # ReSpeaker 4-Mic Array
  sample_rate: 16000
  channels: 1
  chunk_size: 512
```

## æ€»ç»“

**æœ€æœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ³•**ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰ï¼š

1. âœ… **è°ƒæ•´å”¤é†’è¯é˜ˆå€¼**ï¼ˆæœ€ç®€å•æœ‰æ•ˆï¼‰- `wakeword.threshold`
2. âœ… **å¯ç”¨è‡ªé€‚åº” VAD**ï¼ˆå·²å®ç°ï¼‰- `audio_quality.vad.adaptive_enabled`
3. âœ… **ä¼˜åŒ–ä½¿ç”¨ç¯å¢ƒ** - å‡å°‘å™ªéŸ³ï¼Œè°ƒæ•´éº¦å…‹é£ä½ç½®
4. â³ **è®­ç»ƒè‡ªå®šä¹‰æ¨¡å‹**ï¼ˆéœ€è¦æ—¶é—´ï¼‰- ä½¿ç”¨ OpenWakeWord è®­ç»ƒ
5. â³ **å°è¯•å…¶ä»–å¼•æ“**ï¼ˆå¤‡é€‰ï¼‰- å¦‚ Picovoice Porcupine

**ç«‹å³è¡ŒåŠ¨**ï¼š
1. æ£€æŸ¥å½“å‰ `config.yaml` ä¸­çš„ `wakeword.threshold` å€¼
2. æ ¹æ®ä½ çš„ä½¿ç”¨ä½“éªŒè°ƒæ•´é˜ˆå€¼
3. æµ‹è¯•éªŒè¯æ•ˆæœ

éœ€è¦æˆ‘å¸®ä½ ä¿®æ”¹é…ç½®æ–‡ä»¶å—ï¼Ÿ
